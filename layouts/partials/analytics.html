<!-- Add Analytics if enabled in configuration -->
{{ with site.Params.features.analytics }}
<<<<<<< HEAD
<<<<<<< HEAD
    {{ if or .enable .enabled }}
        {{ with .services }}
            <!-- Google Analytics -->
            {{ with .google }}
                {{ $privacyConfig:= dict (slice "Site" "Config" "Privacy" "GoogleAnalytics") $.Site.Config.Privacy.GoogleAnalytics }}
                {{ $analyticsConfig := dict (slice "Site" "Config" "Services" "GoogleAnalytics" "ID") .id }}
                {{ template "_internal/google_analytics.html" (merge $privacyConfig $analyticsConfig) }}
            {{ end }}
=======
=======
>>>>>>> 2e395f0 (initial for rebase)
    {{ if .enabled }}
        <!-- Google Analytics -->
        {{ with .google }}
            {{ $privacyConfig:= dict (slice "Site" "Config" "Privacy" "GoogleAnalytics") $.Site.Config.Privacy.GoogleAnalytics }}
            {{ $analyticsConfig := dict (slice "Site" "GoogleAnalytics") .id }}
            {{ template "_internal/google_analytics.html" (merge $privacyConfig $analyticsConfig) }}
        {{ end }}
<<<<<<< HEAD
>>>>>>> 46969da (updated to stable release)
=======
=======
    {{ if or .enable .enabled }}
        {{ with .services }}
            <!-- Google Analytics -->
            {{ with .google }}
                {{ $privacyConfig:= dict (slice "Site" "Config" "Privacy" "GoogleAnalytics") $.Site.Config.Privacy.GoogleAnalytics }}
                {{ $analyticsConfig := dict (slice "Site" "Config" "Services" "GoogleAnalytics" "ID") .id }}
                {{ template "_internal/google_analytics.html" (merge $privacyConfig $analyticsConfig) }}
            {{ end }}
>>>>>>> upstream/main
>>>>>>> 2e395f0 (initial for rebase)

            <!-- Counter.dev -->
            {{ with .counterDev }}
                <script src="https://cdn.counter.dev/script.js"
                    data-id="{{ .id }}"
                    data-utcoffset="1"
                ></script>
            {{ end }}

<<<<<<< HEAD
<<<<<<< HEAD
            <!-- GoatCounter -->
            {{ with .goatCounter }}
                {{ with .code }}
                    <script data-goatcounter="https://{{ . }}.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
                    {{ else }}
                        <script data-goatcounter="https://{{ .instance }}/count" async src="https://{{ .instance }}/count.js"></script>
                {{ end }}
            {{ end }}

            <!-- Piwik/Matomo -->
            {{ with .matomo }}
            <!-- Matomo -->
                <script>
                var _paq = window._paq = window._paq || [];
                /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
                _paq.push(['trackPageView']);
                _paq.push(['enableLinkTracking']);
                (function() {
                    var u="//{{ .instance }}/";
                    _paq.push(['setTrackerUrl', u+'matomo.php']);
                    _paq.push(['setSiteId', '{{ .siteId }}']);
                    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
                })();
                </script>
            {{ end }}

            {{ with .cloudflare }}
                <!-- Cloudflare Web Analytics -->
                <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
                    data-cf-beacon='{"token": "{{ .token }}"}'
                ></script>
                <!-- End Cloudflare Web Analytics -->
            {{ end }}

            {{ with .umami }}
            <!-- Umami analytics -->
            <script defer src='{{ or .scheme "https" }}://{{ or .instance "analytics.eu.umami.is" }}/script.js' data-website-id="{{ .id }}"></script>
            <!-- End Umami analytics -->
            {{end}}
=======
=======
>>>>>>> 2e395f0 (initial for rebase)
        <!-- GoatCounter -->
        {{ with .goatCounter }}
            <script
            data-goatcounter="https://{{ .code }}.goatcounter.com/count"
            async
            src="/js/goat-counter.js"
            ></script>
        {{ end }}

        <!-- Piwik/Matomo -->
        {{ with .matomo }}
        <!-- Matomo -->
            <script>
            var _paq = window._paq = window._paq || [];
            /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function() {
                var u="//{{ .instance }}/";
                _paq.push(['setTrackerUrl', u+'matomo.php']);
                _paq.push(['setSiteId', '{{ .siteId }}']);
                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
            })();
            </script>
<<<<<<< HEAD
>>>>>>> 46969da (updated to stable release)
=======
=======
            <!-- GoatCounter -->
            {{ with .goatCounter }}
                {{ with .code }}
                    <script data-goatcounter="https://{{ . }}.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
                    {{ else }}
                        <script data-goatcounter="https://{{ .instance }}/count" async src="https://{{ .instance }}/count.js"></script>
                {{ end }}
            {{ end }}

            <!-- Piwik/Matomo -->
            {{ with .matomo }}
            <!-- Matomo -->
                <script>
                var _paq = window._paq = window._paq || [];
                /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
                _paq.push(['trackPageView']);
                _paq.push(['enableLinkTracking']);
                (function() {
                    var u="//{{ .instance }}/";
                    _paq.push(['setTrackerUrl', u+'matomo.php']);
                    _paq.push(['setSiteId', '{{ .siteId }}']);
                    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
                })();
                </script>
            {{ end }}

            {{ with .cloudflare }}
                <!-- Cloudflare Web Analytics -->
                <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
                    data-cf-beacon='{"token": "{{ .token }}"}'
                ></script>
                <!-- End Cloudflare Web Analytics -->
            {{ end }}

            {{ with .umami }}
            <!-- Umami analytics -->
            <script defer src='{{ or .scheme "https" }}://{{ or .instance "analytics.eu.umami.is" }}/script.js' data-website-id="{{ .id }}"></script>
            <!-- End Umami analytics -->
            {{end}}
>>>>>>> upstream/main
>>>>>>> 2e395f0 (initial for rebase)
        {{ end }}
    {{ end }}
{{ end }}

<!-- Keep backwards compatibility and consistency with HUGO defaults -->
{{ if .Site.Config.Services.GoogleAnalytics.ID }}
    {{ template "_internal/google_analytics.html" . }}
{{ end }}
